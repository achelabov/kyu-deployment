import{c as M}from"/build/_shared/chunk-VGJ5EBYX.js";import{Ba as S,Cb as _,xa as o}from"/build/_shared/chunk-NSQYLWAQ.js";import{e as V}from"/build/_shared/chunk-ADMCF34Z.js";var c=t=>{let e=location.search.match(t);return e&&e[2]||void 0},A=/[?&](ref|source|utm_source)=([^?&]+)/,U=/[?&](utm_campaign)=([^?&]+)/,B=/[?&](utm_medium)=([^?&]+)/,$=/[?&](utm_term)=([^?&]+)/,q=/[?&](utm_content)=([^?&]+)/,v=()=>typeof window<"u",P=()=>location?.hostname==="localhost"||location?.hostname==="127.0.0.1"||location?.hostname==="",T=()=>navigator?.webdriver,l=()=>typeof navigator.languages<"u"?navigator.languages[0]:navigator.language,g=()=>{try{return Intl.DateTimeFormat().resolvedOptions().timeZone}catch{return}},f=()=>document.referrer||void 0,w=()=>c(A),x=()=>c(B),k=()=>c(U),b=()=>c($),E=()=>c(q),d=t=>{let e=location.pathname||"";if(t.hash){let r=location.hash.indexOf("?"),s=r>-1?location.hash.substring(0,r):location.hash;e+=s}if(t.search){let r=location.hash.indexOf("?"),s=location.search||(r>-1?location.hash.substring(r):"");e+=s}return e};var p={stop(){}},N="https://api.swetrix.com/log",m=class{constructor(e,r){this.projectID=e,this.options=r,this.pageData=null,this.pageViewsOptions=null,this.errorsOptions=null,this.perfStatsCollected=!1,this.activePage=null,this.errorListenerExists=!1,this.trackPathChange=this.trackPathChange.bind(this),this.heartbeat=this.heartbeat.bind(this),this.captureError=this.captureError.bind(this)}captureError(e){typeof this.errorsOptions?.sampleRate=="number"&&this.errorsOptions.sampleRate>Math.random()||this.submitError({filename:e.filename,lineno:e.lineno,colno:e.colno,name:e.error?.name||"Error",message:e.error?.message||e.message},!0)}trackErrors(e){return this.errorListenerExists||!this.canTrack()?p:(this.errorsOptions=e,window.addEventListener("error",this.captureError),this.errorListenerExists=!0,{stop:()=>{window.removeEventListener("error",this.captureError)}})}submitError(e,r){let s={pid:this.projectID},n={pg:this.activePage||d({hash:this.pageViewsOptions?.hash,search:this.pageViewsOptions?.search}),lc:l(),tz:g(),...e};if(r&&this.errorsOptions?.callback){let i=this.errorsOptions.callback(n);if(i===!1)return;i&&typeof i=="object"&&Object.assign(n,i)}Object.assign(n,s),this.sendRequest("error",n)}async track(e){if(!this.canTrack())return;let r={...e,pid:this.projectID,pg:this.activePage,lc:l(),tz:g(),ref:f(),so:w(),me:x(),ca:k(),te:b(),co:E()};await this.sendRequest("custom",r)}trackPageViews(e){if(!this.canTrack())return p;if(this.pageData)return this.pageData.actions;this.pageViewsOptions=e;let r;e?.unique||(r=setInterval(this.trackPathChange,2e3)),setTimeout(this.heartbeat,3e3);let s=setInterval(this.heartbeat,28e3),n=d({hash:e?.hash,search:e?.search});return this.pageData={path:n,actions:{stop:()=>{clearInterval(r),clearInterval(s)}}},this.trackPage(n,e?.unique),this.pageData.actions}getPerformanceStats(){if(!this.canTrack()||this.perfStatsCollected||!window.performance?.getEntriesByType)return{};let e=window.performance.getEntriesByType("navigation")[0];return e?(this.perfStatsCollected=!0,{dns:e.domainLookupEnd-e.domainLookupStart,tls:e.secureConnectionStart?e.requestStart-e.secureConnectionStart:0,conn:e.secureConnectionStart?e.secureConnectionStart-e.connectStart:e.connectEnd-e.connectStart,response:e.responseEnd-e.responseStart,render:e.domComplete-e.domContentLoadedEventEnd,dom_load:e.domContentLoadedEventEnd-e.responseEnd,page_load:e.loadEventStart,ttfb:e.responseStart-e.requestStart}):{}}heartbeat(){if(!this.pageViewsOptions?.heartbeatOnBackground&&document.visibilityState==="hidden")return;let e={pid:this.projectID};this.sendRequest("hb",e)}trackPathChange(){if(!this.pageData)return;let e=d({hash:this.pageViewsOptions?.hash,search:this.pageViewsOptions?.search}),{path:r}=this.pageData;r!==e&&this.trackPage(e,!1)}trackPage(e,r=!1){if(!this.pageData)return;this.pageData.path=e;let s=this.getPerformanceStats();this.activePage=e,this.submitPageView({pg:e},r,s,!0)}submitPageView(e,r,s,n){let i={pid:this.projectID,perf:s,unique:r},h={lc:l(),tz:g(),ref:f(),so:w(),me:x(),ca:k(),te:b(),co:E(),...e};if(n&&this.pageViewsOptions?.callback){let u=this.pageViewsOptions.callback(h);if(u===!1)return;u&&typeof u=="object"&&Object.assign(h,u)}Object.assign(h,i),this.sendRequest("",h)}canTrack(){return!(this.options?.disabled||!v()||this.options?.respectDNT&&window.navigator?.doNotTrack==="1"||!this.options?.devMode&&P()||T())}async sendRequest(e,r){let s=this.options?.apiURL||N;await fetch(`${s}/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})}};var a=null;function O(t,e){return a||(a=new m(t,e)),a}async function j(t){a&&await a.track(t)}function y(t){return new Promise(e=>{if(!a){e(p);return}typeof document>"u"||document.readyState==="complete"?e(a.trackPageViews(t)):window.addEventListener("load",()=>{e(a.trackPageViews(t))})})}function C(t){return a?a.trackErrors(t):p}function I(t){a&&a.submitPageView(t.payload,Boolean(t.unique),{})}var D=V(M());_();var G="STEzHcB1rALV",F=[/https:\/\/swetrix.com\/projects\/(?!new$)[^/]+$/i,/https:\/\/swetrix.com\/projects\/settings/i,/https:\/\/swetrix.com\/verify/i,/https:\/\/swetrix.com\/password-reset/i,/https:\/\/swetrix.com\/change-email/i,/https:\/\/swetrix.com\/share/i,/https:\/\/swetrix.com\/captchas\/(?!new$)[^/]+$/i,/https:\/\/swetrix.com\/captchas\/settings/i],R=[{regex:/^\/projects\/(?!new$)[^/]+$/i,replacement:"/projects/[id]"},{regex:/^\/projects\/settings/i,replacement:"/projects/settings/[id]"},{regex:/^\/verify/i,replacement:"/verify/[token]"},{regex:/^\/password-reset/i,replacement:"/password-reset/[token]"},{regex:/^\/change-email/i,replacement:"/change-email/[token]"},{regex:/^\/share/i,replacement:"/share/[token]"},{regex:/^\/captchas\/(?!new$)[^/]+$/i,replacement:"/captchas/[id]"},{regex:/^\/captchas\/settings/i,replacement:"/captchas/settings/[id]"},{regex:/^\/ref/i,replacement:"/ref/[id]"},{regex:/\/projects\/([^/]+)\/alerts\/create/i,replacement:"/projects/[id]/alerts/create"},{regex:/\/projects\/([^/]+)\/subscribers\/invite/i,replacement:"/projects/[id]/subscribers/invite"},{regex:/\/projects\/([^/]+)\/alerts\/settings/i,replacement:"/projects/[id]/alerts/settings/[alert]"},{regex:/\/projects\/([^/]+)\/password/i,replacement:"/projects/[id]/password"}],H=(t,e)=>{if(!t)return!1;for(let r=0;r<e.length;++r)if(e[r].test(t))return!0;return!1},L=t=>{if(!t)return t;for(let e=0;e<R.length;++e){let r=R[e];if(r.regex.test(t))return r.replacement}return t};O(G,{devMode:S});var X=/^\/blog\/.+$/,Y=()=>{o||y({callback:({pg:t,ref:e})=>{let r={pg:t,ref:e};return t&&X.test(t)?!1:(r.pg=L(t),H(e,F)&&(r.ref=void 0),r)},heartbeatOnBackground:!0})},ee=t=>{o||I(t)},te=()=>{o||C({callback:({message:t,pg:e})=>(0,D.default)(t,"Minified React error")?!1:{pg:L(e)}})},re=(t,e)=>{o||j({ev:t,meta:e})};export{Y as a,ee as b,te as c,re as d};
