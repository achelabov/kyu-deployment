import{a as ie}from"/build/_shared/chunk-YDSERAUK.js";import{a as k}from"/build/_shared/chunk-6R6UXKZA.js";import{a as le}from"/build/_shared/chunk-NAU26CU7.js";import{a as me,b as ce}from"/build/_shared/chunk-53PIVPIF.js";import{a as N}from"/build/_shared/chunk-NQPXYJUQ.js";import{a as v}from"/build/_shared/chunk-A7SUEVP2.js";import{a as se}from"/build/_shared/chunk-HAINM4MF.js";import{Xc as Xe,a as d,c as Ve,d as Le,hb as H,ib as ze,kc as oe,lc as ae,mc as ne}from"/build/_shared/chunk-QH5UXTNE.js";import{ka as Qe,na as Ye,pa as Je}from"/build/_shared/chunk-GO4RMXDG.js";import{u as We}from"/build/_shared/chunk-GZO74C6C.js";import{g as Ge}from"/build/_shared/chunk-P4GU2T66.js";import{a as Fe}from"/build/_shared/chunk-WKVXRFKR.js";import{b as re,e as Oe}from"/build/_shared/chunk-6UMQ6VR5.js";import{F as D,ha as Ke}from"/build/_shared/chunk-DRCRQ7AX.js";import{b as De,l as He}from"/build/_shared/chunk-NSB5NZWW.js";import{a as L}from"/build/_shared/chunk-KOHXVCYB.js";import{b as $e}from"/build/_shared/chunk-VGJ5EBYX.js";import{c as Y,d as J,e as z,h as X}from"/build/_shared/chunk-O7CS4SBR.js";import{Cb as Be,a as Re,gb as T,ib as E,jb as O,kb as V}from"/build/_shared/chunk-NSQYLWAQ.js";import{b as Z,c as ee}from"/build/_shared/chunk-4YJISJ47.js";import{b as Ue}from"/build/_shared/chunk-VOM23DNI.js";import{a as je,b as te}from"/build/_shared/chunk-TANAHWHW.js";import{c as W,e as l}from"/build/_shared/chunk-ADMCF34Z.js";var de=W((lt,ue)=>{function Ze(s,m,u){var h;return u(s,function(S,q,g){if(m(S,q,g))return h=q,!1}),h}ue.exports=Ze});var fe=W((mt,pe)=>{var et=de(),tt=De(),rt=He();function ot(s,m){return et(s,rt(m,3),tt)}pe.exports=ot});Oe();ze();var i=l(je());Ve();Ke();var p=l(Fe()),ge=l(We()),F=l(Qe()),ye=l(Je()),be=l(Ge()),ve=l(Ue()),K=l(Le()),I=l(Ye()),f=l($e()),A=l(fe()),he=l(Re());Be();Xe();var r=l(te()),at=`${L.user_settings}#integrations`,nt=({alerts:s,setProjectAlerts:m,user:u,setProjectAlertsTotal:h,total:S,loading:q})=>{let g=J(),{id:c,pid:y}=z(),{pathname:Se}=Y(),{t:e}=ee("common"),x=!(0,p.default)(c)&&(0,F.default)((0,F.default)(L.alert_settings,":id",c),":pid",y)===Se,_=(0,i.useMemo)(()=>(0,ye.default)(s,{id:c}),[s,c]),[n,b]=(0,i.useState)({pid:y,name:"",queryTime:V.LAST_1_HOUR,queryCondition:O.GREATER_THAN,queryMetric:E.PAGE_VIEWS,active:!0,queryCustomEvent:""}),[qe,xe]=(0,i.useState)(!1),[M,Ce]=(0,i.useState)({}),[w,Ne]=(0,i.useState)(!1),[ke,G]=(0,i.useState)(!1),Ie=(0,i.useMemo)(()=>(0,p.default)(u)?!1:Boolean(u.telegramChatId&&u.isTelegramChatIdConfirmed||u.slackWebhookUrl||u.discordWebhookUrl),[u]),P=(0,i.useMemo)(()=>{let t=(0,f.default)(V);return(0,I.default)(t,(o,a)=>{let[,$,B]=(0,be.default)(a,"_"),C;return B==="minutes"&&(C=e("alert.xMinutes",{amount:$})),B==="hour"&&(C=e("alert.xHour",{amount:$})),B==="hours"&&(C=e("alert.xHours",{amount:$})),{...o,[a]:C}},{})},[e]),j=(0,i.useMemo)(()=>{let t=(0,f.default)(O);return(0,I.default)(t,(o,a)=>({...o,[a]:e(`alert.conditions.${a}`)}),{})},[e]),R=(0,i.useMemo)(()=>{let t=(0,f.default)(E);return(0,I.default)(t,(o,a)=>({...o,[a]:e(`alert.metrics.${a}`)}),{})},[e]);(0,i.useEffect)(()=>{(0,p.default)(_)||b(_)},[_]);let Ae=()=>{let t={};((0,p.default)(n.name)||(0,ge.default)(n.name)<3)&&(t.name=e("alert.noNameError")),n.queryMetric===E.CUSTOM_EVENTS&&(0,p.default)(n.queryCustomEvent)&&(t.queryCustomEvent=e("alert.noCustomEventError")),Number.isNaN((0,he.default)(n.queryValue))&&(t.queryValue=e("alert.queryValueError"));let o=(0,p.default)((0,ve.default)(t));Ce(t),xe(o)},_e=t=>{x?ae(c,t).then(o=>{g(`/projects/${y}?tab=${T.alerts}`),m([...(0,K.default)(s,a=>a.id!==c),o]),d.success(e("alertsSettings.alertUpdated"))}).catch(o=>{d.error(o.message||o||"Something went wrong")}):oe(t).then(o=>{g(`/projects/${y}?tab=${T.alerts}`),m([...s,o]),h(S+1),d.success(e("alertsSettings.alertCreated"))}).catch(o=>{d.error(o.message||o||"Something went wrong")})},Me=()=>{if(!c){d.error("Something went wrong");return}ne(c).then(()=>{m((0,K.default)(s,t=>t.id!==c)),h(S-1),g(`/projects/${y}?tab=${T.alerts}`),d.success(e("alertsSettings.alertDeleted"))}).catch(t=>{d.error(t.message||t||"Something went wrong")})},Q=()=>{g(`/projects/${y}?tab=${T.alerts}`)};(0,i.useEffect)(()=>{Ae()},[n]);let U=t=>{let{target:o}=t;b(a=>({...a,[o.name]:o.value}))},we=t=>{t.preventDefault(),t.stopPropagation(),Ne(!0),qe&&_e(n)},Pe=x?e("alert.settingsOf",{name:n.name}):e("alert.create");return(0,r.jsxs)("div",{className:se("flex min-h-min-footer flex-col bg-gray-50 px-4 py-6 dark:bg-slate-900 sm:px-6 lg:px-8",{"pb-40":x}),children:[(0,r.jsxs)("form",{className:"mx-auto w-full max-w-7xl",onSubmit:we,children:[(0,r.jsx)("h2",{className:"mt-2 text-3xl font-bold text-gray-900 dark:text-gray-50",children:Pe}),!q&&!Ie&&(0,r.jsxs)("div",{className:"mt-2 flex items-center whitespace-pre-wrap rounded bg-blue-50 px-5 py-3 text-base dark:bg-slate-800 dark:text-gray-50",children:[(0,r.jsx)(D,{className:"mr-1 h-5 w-5"}),(0,r.jsx)(Z,{t:e,i18nKey:"alert.noIntegration",components:{url:(0,r.jsx)(X,{to:at,className:"text-blue-600 hover:underline dark:text-blue-500"})}})]}),(0,r.jsx)(N,{name:"name",label:e("alert.name"),value:n.name||"",placeholder:e("alert.name"),className:"mt-4",onChange:U,error:w?M.name:null}),(0,r.jsx)(ie,{checked:Boolean(n.active),onChange:t=>b(o=>({...o,active:t})),name:"active",className:"mt-4",label:e("alert.enabled"),hint:e("alert.enabledHint")}),(0,r.jsx)("div",{className:"mt-4",children:(0,r.jsx)(k,{id:"queryMetric",label:e("alert.metric"),items:(0,f.default)(R),title:n.queryMetric?R[n.queryMetric]:"",onSelect:t=>{let o=(0,A.default)(R,a=>a===t);b(a=>({...a,queryMetric:o}))},capitalise:!0})}),n.queryMetric===E.CUSTOM_EVENTS&&(0,r.jsx)(N,{name:"queryCustomEvent",label:e("alert.customEvent"),value:n.queryCustomEvent||"",placeholder:e("alert.customEvent"),className:"mt-4",onChange:U,error:w?M.queryCustomEvent:null}),(0,r.jsx)("div",{className:"mt-4",children:(0,r.jsx)(k,{id:"queryCondition",label:e("alert.condition"),items:(0,f.default)(j),title:n.queryCondition?j[n.queryCondition]:"",onSelect:t=>{let o=(0,A.default)(j,a=>a===t);b(a=>({...a,queryCondition:o}))},capitalise:!0})}),(0,r.jsx)(N,{name:"queryValue",label:e("alert.threshold"),value:n.queryValue||"",placeholder:"10",className:"mt-4",onChange:U,error:w?M.queryValue:null}),(0,r.jsx)("div",{className:"mt-4",children:(0,r.jsx)(k,{id:"queryTime",label:e("alert.time"),items:(0,f.default)(P),title:n.queryTime?P[n.queryTime]:"",onSelect:t=>{let o=(0,A.default)(P,a=>a===t);b(a=>({...a,queryTime:o}))},capitalise:!0})}),x?(0,r.jsxs)("div",{className:"mt-5 flex items-center justify-between",children:[(0,r.jsx)(v,{onClick:()=>G(!0),danger:!0,semiSmall:!0,children:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(D,{className:"mr-1 h-5 w-5"}),e("alert.delete")]})}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)(v,{className:"mr-2 border-indigo-100 dark:border-slate-700/50 dark:bg-slate-800 dark:text-gray-50 dark:hover:bg-slate-700",onClick:Q,secondary:!0,regular:!0,children:e("common.cancel")}),(0,r.jsx)(v,{type:"submit",primary:!0,regular:!0,children:e("common.save")})]})]}):(0,r.jsxs)("div",{className:"mt-5 flex items-center justify-between",children:[(0,r.jsx)(v,{className:"mr-2 border-indigo-100 dark:border-slate-700/50 dark:bg-slate-800 dark:text-gray-50 dark:hover:bg-slate-700",onClick:Q,secondary:!0,regular:!0,children:e("common.cancel")}),(0,r.jsx)(v,{type:"submit",primary:!0,regular:!0,children:e("common.save")})]})]}),(0,r.jsx)(le,{onClose:()=>G(!1),onSubmit:Me,submitText:e("alert.delete"),closeText:e("common.close"),title:e("alert.qDelete"),message:e("alert.deleteHint"),submitType:"danger",type:"error",isOpened:ke})]})},Te=ce(nt,me.authenticated);var st=s=>({alerts:s.ui.alerts.alerts,user:s.auth.user,loading:s.auth.loading,total:s.ui.alerts.total}),it=s=>({setProjectAlerts:m=>{s(H.setProjectAlerts(m))},setProjectAlertsTotal:m=>{s(H.setProjectAlertsTotal({total:m}))}}),Ee=re(st,it)(Te);var wt=Ee;export{wt as a};
