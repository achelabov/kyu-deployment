import{a as Vt,b as x}from"/build/_shared/chunk-BOCT2IJB.js";import{a as rt}from"/build/_shared/chunk-EROURRP4.js";import{c as nt}from"/build/_shared/chunk-NK5IF5RF.js";import{a as $t}from"/build/_shared/chunk-RTA5ZRRP.js";import{a as ot}from"/build/_shared/chunk-6R6UXKZA.js";import{a as Z}from"/build/_shared/chunk-NAU26CU7.js";import{a as tt,b as et}from"/build/_shared/chunk-53PIVPIF.js";import{a as h}from"/build/_shared/chunk-NQPXYJUQ.js";import{a as N}from"/build/_shared/chunk-A7SUEVP2.js";import{a as K}from"/build/_shared/chunk-HAINM4MF.js";import{Xc as Ot,a as b,c as kt,d as _t,hb as H,ib as Dt,qc as W,rc as Y,sc as G}from"/build/_shared/chunk-QH5UXTNE.js";import{ka as Rt,pa as jt}from"/build/_shared/chunk-GO4RMXDG.js";import{u as Lt}from"/build/_shared/chunk-GZO74C6C.js";import{g as Pt}from"/build/_shared/chunk-P4GU2T66.js";import{a as Ht}from"/build/_shared/chunk-WKVXRFKR.js";import{a as J,d as X,e as wt}from"/build/_shared/chunk-6UMQ6VR5.js";import{F as z,ha as At}from"/build/_shared/chunk-DRCRQ7AX.js";import{n as Bt}from"/build/_shared/chunk-NSB5NZWW.js";import{a as Q}from"/build/_shared/chunk-KOHXVCYB.js";import{c as Et}from"/build/_shared/chunk-VGJ5EBYX.js";import{c as F,d as U}from"/build/_shared/chunk-O7CS4SBR.js";import{Cb as Mt,gb as T}from"/build/_shared/chunk-NSQYLWAQ.js";import{c as B}from"/build/_shared/chunk-4YJISJ47.js";import{b as xt}from"/build/_shared/chunk-VOM23DNI.js";import{a as Tt,b as q}from"/build/_shared/chunk-TANAHWHW.js";import{e as i}from"/build/_shared/chunk-ADMCF34Z.js";var s=i(Tt());At();var S=i(Ht()),st=i(Lt()),A=i(Rt()),mt=i($t()),P=i(Pt()),lt=i(jt()),ct=i(Et()),R=i(Vt()),D=i(Bt()),ut=i(xt()),L=i(_t());Mt();Ot();wt();kt();Dt();var e=i(q()),Ft=["HTTP"],E=[30,60,120,180,300,600,900,1200,1800,2700,3600,7200,10800,21600,43200,57600,72e3,86400],Ut=[30,60,300,1800,3600,21600,86400],j=(a,p,f="short")=>{let l;return a<60?l=x(a,"second",p,f):a<3600?l=x(a/60,"minute",p,f):l=x(a/3600,"hour",p,f),l},at=({value:a,onChange:p,label:f,hint:l,name:c})=>{let m=(0,s.useId)(),{i18n:{language:M}}=B("common"),t=u=>{let{value:d,name:g}=u.target;p({target:{name:g,value:E[Number(d)]}})};return(0,e.jsxs)("div",{className:"mt-4",children:[(0,e.jsx)(h,{list:m,name:c,label:f,hint:l,hintPosition:"top",type:"range",min:"0",max:E.length-1,value:a?E.indexOf(Number(a)):4,classes:{input:"arrows-handle mt-4 h-2 w-full rounded-full bg-gray-200 dark:bg-slate-600"},onChange:t}),(0,e.jsx)("datalist",{style:{writingMode:"vertical-lr"},className:"flex w-full flex-col justify-between",id:m,children:(0,D.default)(E,(u,d)=>{if(!(0,ct.default)(Ut,u))return(0,e.jsx)("option",{value:d},u);let g=j(u,M);return(0,e.jsx)("option",{className:"mt-4 text-sm lg:mt-0 lg:-rotate-90 lg:text-center",value:d,label:g},u)})})]})},it=100,qt=()=>{let{monitors:a,total:p}=J(o=>o.ui.monitors),f=X(),l=U(),{id:c,pid:m}=rt(),{pathname:M}=F(),{t,i18n:{language:u}}=B("common"),d=!(0,S.default)(c)&&(0,A.default)((0,A.default)(Q.uptime_settings,":id",c),":pid",m)===M,g=(0,s.useMemo)(()=>(0,lt.default)(a,{id:c}),[a,c]),[r,w]=(0,s.useState)({type:"HTTP",projectId:m,name:"",url:"",interval:60,retries:3,retryInterval:60,timeout:30,acceptedStatusCodes:"200",description:""}),[dt,pt]=(0,s.useState)(!1),[y,ft]=(0,s.useState)({}),[I,gt]=(0,s.useState)(!1),[bt,O]=(0,s.useState)(!1),k=o=>f(H.setMonitors(o)),$=o=>f(H.setMonitorsTotal({total:o}));(0,s.useEffect)(()=>{(0,S.default)(g)||w({...g,acceptedStatusCodes:(0,mt.default)(g.acceptedStatusCodes,",")})},[g]);let vt=()=>{let o={};((0,S.default)(r.name)||(0,st.default)(r.name)<3)&&(o.name=t("alert.noNameError")),(0,S.default)(r.url)&&(o.url=t("apiNotifications.inputCannotBeEmpty")),nt(r.url)||(o.url=t("monitor.error.urlInvalid"));let n=Number(r.retries);(0,R.default)(n)&&(o.retries=t("apiNotifications.enterACorrectNumber")),n<=0&&(o.retries=t("apiNotifications.numberCantBeNegative")),n>it&&(o.retries=t("apiNotifications.numberCantBeBigger",{max:it}));let C=(0,P.default)(r.acceptedStatusCodes,",");(0,S.default)(C)&&(o.acceptedStatusCodes=t("apiNotifications.inputCannotBeEmpty")),C.some(It=>{let _=Number(It.trim());return(0,R.default)(_)||_<100||_>599})&&(o.acceptedStatusCodes=t("monitor.error.acceptedStatusCodesNotValid"));let yt=(0,S.default)((0,ut.default)(o));ft(o),pt(yt)},ht=o=>{d?Y(m,c,o).then(n=>{l(`/projects/${m}?tab=${T.uptime}`),k([...(0,L.default)(a,C=>C.id!==c),n]),b.success(t("monitor.monitorUpdated"))}).catch(n=>{b.error(n.message||n||"Something went wrong")}):W(m,o).then(n=>{l(`/projects/${m}?tab=${T.uptime}`),k([...a,n]),$(p+1),b.success(t("monitor.monitorCreated"))}).catch(n=>{b.error(n.message||n||"Something went wrong")})},St=()=>{if(!c){b.error("Something went wrong");return}G(m,c).then(()=>{k((0,L.default)(a,o=>o.id!==c)),$(p-1),l(`/projects/${m}?tab=${T.uptime}`),b.success(t("monitor.monitorDeleted"))}).catch(o=>{b.error(o.message||o||"Something went wrong")})},V=()=>{l(`/projects/${m}?tab=${T.uptime}`)};(0,s.useEffect)(()=>{vt()},[r]);let v=o=>{let{target:n}=o;w(C=>({...C,[n.name]:n.value}))},Ct=o=>{o.preventDefault(),o.stopPropagation(),gt(!0),dt&&ht({...r,acceptedStatusCodes:(0,D.default)((0,P.default)(r.acceptedStatusCodes,","),n=>parseInt(n,10))})},Nt=d?t("monitor.settingsOf",{name:r.name}):t("monitor.create");return(0,e.jsxs)("div",{className:K("flex min-h-min-footer flex-col bg-gray-50 px-4 py-6 dark:bg-slate-900 sm:px-6 lg:px-8",{"pb-40":d}),children:[(0,e.jsxs)("form",{className:"mx-auto w-full max-w-7xl",onSubmit:Ct,children:[(0,e.jsx)("h2",{className:"mt-2 text-3xl font-bold text-gray-900 dark:text-gray-50",children:Nt}),(0,e.jsx)(h,{name:"name",label:t("monitor.form.name"),value:r.name||"",className:"mt-4",onChange:v,error:I?y.name:null}),(0,e.jsx)("div",{className:"mt-4",children:(0,e.jsx)(ot,{id:"type",label:t("monitor.form.type"),items:Ft,title:r.type,onSelect:o=>{w(n=>({...n,type:o}))},capitalise:!0})}),(0,e.jsx)(h,{name:"url",label:t("monitor.form.url"),value:r.url||"",className:"mt-4",onChange:v,error:I?y.url:null}),(0,e.jsx)(at,{name:"interval",label:t("monitor.form.interval"),hint:t("monitor.form.intervalHint",{intervalTranslated:j(Number(r.interval),u,"long")}),value:r.interval,onChange:v}),(0,e.jsx)(h,{name:"retries",label:t("monitor.form.retries"),hint:t("monitor.form.retriesHint",{retries:r.retries||"N/A"}),value:r.retries,className:"mt-4",onChange:v,error:I?y.retries:null}),(0,e.jsx)(at,{name:"retryInterval",label:t("monitor.form.retryInterval"),hint:t("monitor.form.retryIntervalHint",{retryIntervalTranslated:j(Number(r.retryInterval),u,"long")}),value:r.retryInterval,onChange:v}),(0,e.jsx)(h,{name:"timeout",label:t("monitor.form.timeout"),hint:t("monitor.form.timeoutHint",{x:r.timeout||"N/A"}),value:r.timeout||"",className:"mt-4",onChange:v,error:I?y.timeout:null}),(0,e.jsx)(h,{name:"acceptedStatusCodes",label:t("monitor.form.acceptedStatusCodes"),value:r.acceptedStatusCodes||"",className:"mt-4",onChange:v,error:I?y.acceptedStatusCodes:null}),d?(0,e.jsxs)("div",{className:"mt-5 flex items-center justify-between",children:[(0,e.jsx)(N,{onClick:()=>O(!0),danger:!0,semiSmall:!0,children:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(z,{className:"mr-1 h-5 w-5"}),t("monitor.delete")]})}),(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsx)(N,{className:"mr-2 border-indigo-100 dark:border-slate-700/50 dark:bg-slate-800 dark:text-gray-50 dark:hover:bg-slate-700",onClick:V,secondary:!0,regular:!0,children:t("common.cancel")}),(0,e.jsx)(N,{type:"submit",primary:!0,regular:!0,children:t("common.save")})]})]}):(0,e.jsxs)("div",{className:"mt-5 flex items-center justify-between",children:[(0,e.jsx)(N,{className:"mr-2 border-indigo-100 dark:border-slate-700/50 dark:bg-slate-800 dark:text-gray-50 dark:hover:bg-slate-700",onClick:V,secondary:!0,regular:!0,children:t("common.cancel")}),(0,e.jsx)(N,{type:"submit",primary:!0,regular:!0,children:t("common.save")})]})]}),(0,e.jsx)(Z,{onClose:()=>O(!1),onSubmit:St,submitText:t("monitor.delete"),closeText:t("common.close"),title:t("monitor.qDelete"),message:t("monitor.deleteHint"),submitType:"danger",type:"error",isOpened:bt})]})},pe=et(qt,tt.authenticated);export{pe as a};
