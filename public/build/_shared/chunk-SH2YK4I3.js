import{d as ye}from"/build/_shared/chunk-FINNWZUQ.js";import{a as ve}from"/build/_shared/chunk-4GVLMWJ7.js";import{a as M}from"/build/_shared/chunk-YDSERAUK.js";import{a as ht}from"/build/_shared/chunk-RTA5ZRRP.js";import{a as ke}from"/build/_shared/chunk-6R6UXKZA.js";import{a as B}from"/build/_shared/chunk-NAU26CU7.js";import{a as je,b as xe}from"/build/_shared/chunk-53PIVPIF.js";import{a as x}from"/build/_shared/chunk-NQPXYJUQ.js";import{a as h}from"/build/_shared/chunk-A7SUEVP2.js";import{b as L}from"/build/_shared/chunk-HAINM4MF.js";import{Ab as ge,Cb as de,Eb as fe,Hc as ue,Ic as be,Xc as ft,a as c,c as at,d as ot,hb as F,ib as gt,tc as he,zb as pe}from"/build/_shared/chunk-QH5UXTNE.js";import{ka as lt,pa as pt}from"/build/_shared/chunk-GO4RMXDG.js";import{u as mt}from"/build/_shared/chunk-GZO74C6C.js";import{g as ct}from"/build/_shared/chunk-P4GU2T66.js";import{a as it,p as me,q as dt}from"/build/_shared/chunk-WKVXRFKR.js";import{b as ne,e as rt}from"/build/_shared/chunk-6UMQ6VR5.js";import{F as ce,ba as le,ha as nt}from"/build/_shared/chunk-DRCRQ7AX.js";import{n as st}from"/build/_shared/chunk-NSB5NZWW.js";import{a as u}from"/build/_shared/chunk-KOHXVCYB.js";import{c as et}from"/build/_shared/chunk-VGJ5EBYX.js";import{a as Ye}from"/build/_shared/chunk-Z3FUFQEO.js";import{d as te,e as re}from"/build/_shared/chunk-O7CS4SBR.js";import{Cb as tt,J as oe,xa as se}from"/build/_shared/chunk-NSQYLWAQ.js";import{c as ae}from"/build/_shared/chunk-4YJISJ47.js";import{b as Ze}from"/build/_shared/chunk-VOM23DNI.js";import{a as We,b as ie}from"/build/_shared/chunk-TANAHWHW.js";import{e as n}from"/build/_shared/chunk-ADMCF34Z.js";rt();gt();dt();var a=n(We());at();var g=n(it()),T=n(mt()),Ie=n(lt()),$=n(pt()),G=n(ht()),U=n(Ye()),X=n(ct()),we=n(Ze()),O=n(st()),q=n(ot()),Be=n(et());nt();tt();ft();var r=n(ie()),Ce=50,Se=300,Ne=300,Pe=[{name:"new",label:"project.captcha.settings.general"},{name:"inheritance",label:"project.captcha.settings.inheritance"}],ut="new",v="inheritance",bt=({loadProjects:m,isLoading:y,projects:E,removeProject:_e,user:z,deleteProjectCache:Ae,analyticsProjects:k,loading:_,isSettings:l})=>{let{t}=ae("common"),{id:p}=re(),s=(0,a.useMemo)(()=>(0,$.default)([...E,...k],e=>e.id===p)||{},[E,k,p]),b=te(),[i,C]=(0,a.useState)({name:"",id:p,public:!1,isCaptcha:!0}),[Ke,Re]=(0,a.useState)(!1),[S,He]=(0,a.useState)({}),[N,De]=(0,a.useState)(!1),[Fe,A]=(0,a.useState)(!1),[Le,K]=(0,a.useState)(!1),[j,J]=(0,a.useState)(!1),[V,Q]=(0,a.useState)(!1),[R,W]=(0,a.useState)(!1),[d,Me]=(0,a.useState)(Pe[0].name),[P,$e]=(0,a.useState)(),[I,Ge]=(0,a.useState)([]),[H,Ue]=(0,a.useState)(s==null?void 0:s.captchaSecretKey),[Xe,D]=(0,a.useState)(!1);(0,a.useEffect)(()=>{_||(!z.isActive&&!se&&(c.error(t("project.captcha.settings.verify")),b(u.dashboard)),!y&&l&&!j&&((0,g.default)(s)||s!=null&&s.uiHidden?(c.error(t("project.captcha.noExist")),b(u.dashboard)):C({...s,ipBlacklist:(0,U.default)(s.ipBlacklist)?s.ipBlacklist:(0,G.default)(s.ipBlacklist,", "),origins:(0,U.default)(s.origins)?s.origins:(0,G.default)(s.origins,", ")})))},[z,s,y,l,b,j,t,_]);let Y=async e=>{if(!R){W(!0);try{let o={...e,origins:(0,g.default)(e.origins)?null:(0,O.default)((0,X.default)(e.origins,","),f=>{try{return(0,Be.default)(f,"localhost")?f:new URL(f).host}catch{return f}}),ipBlacklist:(0,g.default)(e.ipBlacklist)?null:(0,X.default)(e.ipBlacklist,",")};if(l)await ge(p,o),c.success(t("project.settings.updated"));else{if(d===v){if((0,g.default)(P)){c.error("Select projects");return}await be(o.id)}else await pe({name:o.name,isCaptcha:!0});ye("CAPTCHA_CREATED"),c.success(t("project.settings.created"))}m(),b(u.dashboard)}catch(o){c.error(o)}finally{W(!1)}}},Oe=async()=>{if(A(!1),!j){J(!0);try{await de(p),_e(p),c.success(t("project.settings.deleted")),b(u.dashboard)}catch(e){c.error(e)}finally{J(!1)}}},qe=async()=>{if(K(!1),!V){Q(!0);try{await fe(p),Ae(p),c.success(t("project.settings.resetted")),b(u.dashboard)}catch(e){c.error(e)}finally{Q(!1)}}},ze=()=>{let e={};(0,g.default)(i.name)&&v!==d&&(e.name=t("project.settings.noNameError")),(0,T.default)(i.name)>Ce&&v!==d&&(e.name=t("project.settings.pxCharsError",{amount:Ce})),(0,T.default)(i.origins)>Se&&(e.origins=t("project.settings.oxCharsError",{amount:Se})),(0,T.default)(i.ipBlacklist)>Ne&&(e.ipBlacklist=t("project.settings.oxCharsError",{amount:Ne}));let o=(0,g.default)((0,we.default)(e));He(e),Re(o)};(0,a.useEffect)(()=>{ze()},[i]);let w=e=>{let{target:o}=e;C(f=>({...f,[o.name]:o.value}))},Je=e=>{if(e.preventDefault(),e.stopPropagation(),De(!0),d===v){let o=(0,$.default)(I||k,f=>`${f.name} | ${f.id}`===P);(0,g.default)(o)&&c.error("Please select a project"),Y({...o,isCaptcha:!0});return}Ke&&Y(i)},Z=()=>{b(l?(0,Ie.default)(u.captcha,":id",p):u.dashboard)},Ve=l?`${t("project.settings.settings")} ${i.name}`:t("project.settings.create");(0,a.useEffect)(()=>{let e=l?`${t("project.settings.settings")} ${i.name}`:t("project.settings.create");e+=` ${oe}`,document.title=e},[i,t,l]);let ee=async()=>{try{let e=await he(p);Ue(e)}catch(e){c.error(e)}},Qe=async()=>{await ue().then(e=>{Ge(e)}).catch(console.error)};return(0,a.useEffect)(()=>{(0,g.default)(I)&&Qe()},[d]),_?(0,r.jsx)("div",{className:"flex min-h-min-footer flex-col bg-gray-50 px-4 py-6 dark:bg-slate-900 sm:px-6 lg:px-8",children:(0,r.jsx)(ve,{})}):(0,r.jsxs)("div",{className:L("flex min-h-min-footer flex-col bg-gray-50 px-4 py-6 dark:bg-slate-900 sm:px-6 lg:px-8",{"pb-40":l}),children:[(0,r.jsxs)("form",{className:"mx-auto w-full max-w-7xl",onSubmit:Je,children:[(0,r.jsx)("h2",{className:"mt-2 text-3xl font-bold text-gray-900 dark:text-gray-50",children:Ve}),(0,r.jsx)("h3",{className:"mt-2 text-lg font-bold text-gray-900 dark:text-gray-50",children:t("profileSettings.general")}),(0,r.jsx)("div",{className:"mt-6",children:!l&&(0,q.default)(I||k,e=>!(e!=null&&e.isCaptchaProject)).length>0&&(0,r.jsx)("nav",{className:"-mb-px flex space-x-8",children:(0,O.default)(Pe,e=>(0,r.jsx)("button",{type:"button",onClick:()=>Me(e.name),className:L("text-md whitespace-nowrap border-b-2 px-1 pb-4 font-medium",{"border-indigo-500 text-indigo-600 dark:text-indigo-500":d===e.name,"border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 dark:text-gray-400 dark:hover:border-gray-300 dark:hover:text-gray-300":d!==e.name}),children:t(e.label)},e.name))})}),d===ut&&(0,r.jsx)(x,{name:"name",label:t("project.captcha.settings.name"),value:i.name,placeholder:"My awesome project",className:"mt-4",onChange:w,error:N?S.name:null}),d===v&&(0,r.jsx)(ke,{title:(0,g.default)(P)?"select project":P,label:t("profileSettings.selectProject"),className:"w-full",items:(0,q.default)(I||k,e=>!e.isCaptchaProject),labelExtractor:e=>`${e.name} | ${e.id}`,keyExtractor:e=>e.id,onSelect:e=>$e(e),capitalise:!0}),l?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(x,{name:"id",label:t("project.captcha.settings.pid"),value:i.id,className:"mt-4",onChange:w,error:N?S.id:null,disabled:!0}),(0,r.jsx)(x,{name:"origins",label:t("project.settings.origins"),hint:t("project.settings.originsHint"),value:i.origins||"",className:"mt-4",onChange:w,error:N?S.origins:null}),(0,r.jsx)(x,{name:"ipBlacklist",label:t("project.settings.ipBlacklist"),hint:t("project.settings.ipBlacklistHint"),value:i.ipBlacklist||"",className:"mt-4",onChange:w,error:N?S.ipBlacklist:null,isBeta:!0}),(0,r.jsx)("hr",{className:"mt-5 border-gray-200 dark:border-gray-600"}),(0,r.jsx)("h3",{className:"mt-2 flex items-center text-lg font-bold text-gray-900 dark:text-gray-50",children:t("profileSettings.captchaSecretKey")}),H?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("p",{className:"max-w-prose text-base text-gray-900 dark:text-gray-50",children:t("profileSettings.captchaSecretKeyHint")}),(0,r.jsx)("div",{className:"grid grid-cols-1 gap-x-4 gap-y-6 lg:grid-cols-2",children:(0,r.jsx)(x,{label:t("profileSettings.captchaSecretKey"),name:"sercretKey",className:"mt-4",value:H,disabled:!0})})]}):(0,r.jsx)("p",{className:"max-w-prose text-base text-gray-900 dark:text-gray-50",children:t("profileSettings.noApiKey")}),H?(0,r.jsx)(h,{className:"mt-4",onClick:()=>D(!0),danger:!0,large:!0,children:t("profileSettings.regenerateSecretKey")}):(0,r.jsx)(h,{className:"mt-4",onClick:ee,primary:!0,large:!0,children:t("profileSettings.generateSecretKey")}),(0,r.jsx)("hr",{className:"mt-5 border-gray-200 dark:border-gray-600"}),(0,r.jsx)(M,{checked:Boolean(i.active),onChange:e=>C(o=>({...o,active:e})),name:"active",className:"mt-4",label:t("project.captcha.settings.enabled"),hint:t("project.captcha.settings.enabledHint")}),(0,r.jsx)(M,{checked:Boolean(i.public),onChange:e=>C(o=>({...o,public:e})),name:"public",className:"mt-4",label:t("project.settings.public"),hint:t("project.settings.publicHint")}),(0,r.jsxs)("div",{className:"mt-8 flex flex-wrap justify-center gap-2 sm:justify-between",children:[(0,r.jsxs)("div",{className:"flex flex-wrap items-center justify-center gap-2",children:[(0,r.jsx)(h,{className:"border-indigo-100 dark:border-slate-700/50 dark:bg-slate-800 dark:text-gray-50 dark:hover:bg-slate-700",onClick:Z,secondary:!0,regular:!0,children:t("common.cancel")}),(0,r.jsx)(h,{type:"submit",loading:R,primary:!0,regular:!0,children:t("common.save")})]}),(0,r.jsxs)("div",{className:"flex flex-wrap items-center justify-center gap-2",children:[(0,r.jsx)(h,{onClick:()=>!V&&K(!0),loading:j,semiDanger:!0,semiSmall:!0,children:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(le,{className:"mr-1 h-5 w-5"}),t("project.settings.reset")]})}),(0,r.jsx)(h,{onClick:()=>!j&&A(!0),loading:j,danger:!0,semiSmall:!0,children:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ce,{className:"mr-1 h-5 w-5"}),t("project.settings.delete")]})})]})]}),(0,r.jsx)("hr",{className:"mt-2 border-gray-200 dark:border-gray-600 sm:mt-5"})]}):(0,r.jsx)("p",{className:"mb-4 mt-1 text-sm italic text-gray-500 dark:text-gray-300",children:t("project.settings.createHint")}),!l&&(0,r.jsxs)("div",{children:[(0,r.jsx)(h,{className:"mr-2 border-indigo-100 dark:border-slate-700/50 dark:bg-slate-800 dark:text-gray-50 dark:hover:bg-slate-700",onClick:Z,secondary:!0,regular:!0,children:t("common.cancel")}),(0,r.jsx)(h,{type:"submit",loading:R,primary:!0,regular:!0,children:t("common.save")})]})]}),(0,r.jsx)(B,{onClose:()=>A(!1),onSubmit:Oe,submitText:t("project.settings.delete"),closeText:t("common.close"),title:t("project.settings.qDelete"),message:t("project.settings.deleteHint"),submitType:"danger",type:"error",isOpened:Fe}),(0,r.jsx)(B,{onClose:()=>K(!1),onSubmit:qe,submitText:t("project.settings.reset"),closeText:t("common.close"),title:t("project.settings.qReset"),message:t("project.settings.resetHint"),submitType:"danger",type:"error",isOpened:Le}),(0,r.jsx)(B,{onClose:()=>D(!1),onSubmit:()=>{D(!1),ee()},submitText:t("profileSettings.regenerateSecretKey"),closeText:t("common.close"),title:t("profileSettings.regenerateSecretKeyTitle"),submitType:"danger",type:"error",message:t("profileSettings.regenerateSecretKeyMessage"),isOpened:Xe})]})},Te=(0,a.memo)(xe(bt,je.authenticated));var yt=m=>({projects:m.ui.projects.captchaProjects,analyticsProjects:m.ui.projects.projects,isLoading:m.ui.projects.isLoadingCaptcha,loading:m.auth.loading,user:m.auth.user}),jt=m=>({loadProjects:()=>{me.loadProjectsCaptcha()},removeProject:y=>{m(F.removeCaptchaProject(y))},deleteProjectCache:(y,E)=>{m(F.deleteCaptchaProjectCache({pid:y}))}}),Ee=ne(yt,jt)(Te);var Ot=Ee;export{Ot as a};
