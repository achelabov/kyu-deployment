!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self)["swetrix-sdk"]=t()}(this,function(){"use strict";var __assign=function(){return(__assign=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},getPanelTabName=function(e,t){return"".concat(e,"-").concat(t)},event,PanelTab,DebugType,SDK=(!function(e){e.LOAD="load",e.FILTERS_UPDATE="filtersupdate",e.TIME_UPDATE="timeupdate",e.PROJECT_INFO="projectinfo",e.CLIENT_INFO="clientinfo"}(event=event||{}),!function(e){e.cc="cc",e.pg="pg",e.lc="lc",e.ref="ref",e.dv="dv",e.br="br",e.os="os",e.so="so",e.me="me",e.ca="ca",e.lt="lt",e.ce="ce"}(PanelTab=PanelTab||{}),!function(e){e.LOG="log",e.ERROR="error",e.WARN="warn",e.INFO="info"}(DebugType=DebugType||{}),function(){function SDK(extensions,options,swetrixCallbacks){var _this=this;this.extensions=extensions,this.options=options,this.swetrixCallbacks=swetrixCallbacks,this.events={},this.exportDataRowValues=[],this.panelTabValues=[],this._sdkInitialised=!1,this._emitQueue=[],this._loadExtension=function(cdnURL,id){return fetch(cdnURL).then(function(e){return e.ok?e.text():(_this.debug("Error while loading extension from ".concat(cdnURL),DebugType.ERROR),"(() => {})")}).then(function(code){eval(code)(__assign(__assign({},_this),{addExportDataRow:_this.addExportDataRow,debug:_this.debug,removeExportDataRow:_this.removeExportDataRow,addPanelTab:_this.addPanelTab(id),updatePanelTab:_this.updatePanelTab(id),removePanelTab:_this.removePanelTab(id),addEventListener:_this.addEventListener(id),removeEventListener:_this.removeEventListener(id),_emitEvent:void 0,_destroy:void 0,_loadExtension:void 0,_init:void 0,_emitQueue:void 0})),_this.debug("Extension ".concat(id," loaded and executed"))})},this._init()}return SDK.prototype._init=function(){var e,n=this;this._sdkInitialised?this.debug("SDK is already initialised, skipping initialisation"):null!=(e=this.options)&&e.disabled?this.debug("SDK is disabled, skipping initialisation"):(e=this.extensions.map(function(e){var t=e.cdnURL,e=e.id;return n._loadExtension(t,e)}),Promise.all(e).then(function(){n.debug("SDK initialised"),n._sdkInitialised=!0,n._emitQueue.forEach(function(e){var t=e.event,e=e.eventData;n._emitEvent(t,e)}),n._emitQueue=[]}))},SDK.prototype.debug=function(e,t){var n;void 0===t&&(t=DebugType.LOG),null!=(n=this.options)&&n.debug&&console[t]("[Swetrix SDK]",e)},SDK.prototype._emitEvent=function(e,t){this._sdkInitialised?(this.debug("Emitting event '".concat(e,"'")),this.events[e]&&Object.values(this.events[e]).forEach(function(e){setTimeout(function(){e(t)},300)})):(this.debug("Trying to emit event '".concat(e,"', but it as added to queue as the SDK is not initialised yet"),DebugType.WARN),this._emitQueue.push({event:e,eventData:t}))},SDK.prototype._destroy=function(){this.debug("Destroying the SDK instance"),this.events={},this.extensions=[]},SDK.prototype.addEventListener=function(i){var a=this;return function(e,t){var n;a.debug("Adding event listener for ".concat(e," (extension: ").concat(i,")")),"function"!=typeof t?a.debug("Callback is not a function (extension: ".concat(i,")"),DebugType.ERROR):a.events=__assign(__assign({},a.events),((n={})[e]=__assign(__assign({},a.events[e]),((e={})[i]=t,e)),n))}},SDK.prototype.removeEventListener=function(t){var n=this;return function(e){n.debug("Removing event listener for ".concat(e)),n.events[e]&&null!=(e=n.events[e])&&delete e[t]}},SDK.prototype.addExportDataRow=function(e,t){var n;this.debug("Adding export data row ".concat(e)),this.exportDataRowValues.includes(e)?this.debug("Export data row ".concat(e," already exists"),DebugType.WARN):(this.exportDataRowValues.push(e),null!=(n=this.swetrixCallbacks)&&n.onAddExportDataRow(e,t))},SDK.prototype.removeExportDataRow=function(t){var e;this.debug("Removing export data row ".concat(t)),this.exportDataRowValues.includes(t)?(this.exportDataRowValues=this.exportDataRowValues.filter(function(e){return e!==t}),null!=(e=this.swetrixCallbacks)&&e.onRemoveExportDataRow(t)):this.debug("Export data row ".concat(t," does not exist"),DebugType.WARN)},SDK.prototype.addPanelTab=function(a){var o=this;return function(e,t,n){void 0===n&&(n=function(){}),o.debug("Adding panel tab ".concat(e));var i=getPanelTabName(a,e);o.panelTabValues.includes(i)?o.debug("Panel tab ".concat(e," (").concat(a,") already exists"),DebugType.WARN):(o.panelTabValues.push(i),null!=(i=o.swetrixCallbacks)&&i.onAddPanelTab(a,e,t,n))}},SDK.prototype.updatePanelTab=function(i){var a=this;return function(e,t){a.debug("Updating panel tab ".concat(e));var n=getPanelTabName(i,e);a.panelTabValues.includes(n)?null!=(n=a.swetrixCallbacks)&&n.onUpdatePanelTab(i,e,t):a.debug("Panel tab ".concat(e," (").concat(i,") does not exist"),DebugType.WARN)}},SDK.prototype.removePanelTab=function(n){var i=this;return function(e){i.debug("Removing panel tab ".concat(e));var t=getPanelTabName(n,e);i.panelTabValues.includes(t)?null!=(t=i.swetrixCallbacks)&&t.onRemovePanelTab(n,e):i.debug("Panel tab ".concat(e," (").concat(n,") does not exist"),DebugType.WARN)}},SDK}());return SDK});
